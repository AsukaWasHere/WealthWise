<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Financial Advisor - PolyFox</title>
    <link rel="stylesheet" href="../css/main.css" />
</head>
<body class="bg-background text-text-primary">
    <nav class="bg-white/95 backdrop-blur-sm border-b border-border sticky top-0 z-50">
        </nav>

    <section class="relative bg-gradient-to-br from-primary-50 via-white to-accent-50 py-16">
        </section>

    <section class="py-20 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <form id="assessment-form" class="card max-w-2xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-4">Your Financial Assessment</h2>
                    <p class="text-text-secondary">Enter your details to receive a personalized financial insight.</p>
                </div>

                <div class="space-y-6">
                    <div>
                        <label for="age" class="block text-sm font-medium text-text-primary mb-2">Age</label>
                        <input type="number" id="age" class="input-field" value="32" required />
                    </div>
                    <div>
                        <label for="income" class="block text-sm font-medium text-text-primary mb-2">Annual Income (INR)</label>
                        <input type="number" id="income" class="input-field" value="9000000" required />
                    </div>
                    <div>
                        <label for="goals" class="block text-sm font-medium text-text-primary mb-2">Financial Goals</label>
                        <textarea id="goals" class="input-field" rows="3" required>Long-term wealth growth and buying a second property in 10 years.</textarea>
                    </div>
                    <div>
                        <label for="investments" class="block text-sm font-medium text-text-primary mb-2">Current Investments</label>
                        <textarea id="investments" class="input-field" rows="3" required>Mix of equity mutual funds and some government bonds.</textarea>
                    </div>
                </div>

                <div class="flex justify-end mt-8">
                    <button type="submit" id="submit-button" class="btn-primary">
                        Get My AI Insight
                    </button>
                </div>
            </form>

            <div id="results-container" class="mt-12"></div>
        </div>
    </section>
    
    <footer class="bg-primary-800 text-white py-16">
        </footer>

    <script>
        // Standard function to toggle the mobile navigation menu
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        // --- NEW LOGIC TO CONNECT TO THE BACKEND ---
        const assessmentForm = document.getElementById('assessment-form');
        const resultsContainer = document.getElementById('results-container');
        const submitButton = document.getElementById('submit-button');

        assessmentForm.addEventListener('submit', async function(event) {
            // 1. Prevent the page from reloading on form submission
            event.preventDefault(); 

            // 2. Show a loading state to the user
            submitButton.disabled = true;
            submitButton.innerHTML = 'Analyzing...';
            resultsContainer.innerHTML = `
                <div class="text-center p-10">
                    <div class="w-12 h-12 mx-auto border-4 border-gray-200 border-t-primary rounded-full animate-spin"></div>
                    <p class="mt-4 text-text-secondary">Please wait while our AI analyzes your profile...</p>
                </div>`;

            // 3. Gather the data from the form inputs
            const formData = {
                age: parseInt(document.getElementById('age').value),
                income: parseInt(document.getElementById('income').value),
                goals: document.getElementById('goals').value,
                current_investments: document.getElementById('investments').value,
            };

            // 4. Define the URL of your live backend on Render
            const apiUrl = 'https://polyfox-backend.onrender.com/api/analyze'; // <-- IMPORTANT: Use your actual Render URL

            try {
                // 5. Send the data to the backend
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData),
                });

                if (!response.ok) {
                    throw new Error(`Network error: ${response.statusText}`);
                }
                const data = await response.json();
                const insight = data.insight;

                // 6. Dynamically build and display the results
                resultsContainer.innerHTML = `
                    <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-border space-y-8">
                        <h2 class="text-2xl font-bold text-center text-primary">${insight.summary}</h2>
                        <div class="space-y-4">
                            <div class="p-4 rounded-lg border-l-4 border-l-success bg-green-50 text-green-800">
                                <h3 class="font-semibold flex items-center gap-2">üí° Opportunity Identified</h3>
                                <p class="text-text-secondary text-sm mt-1">${insight.opportunity}</p>
                            </div>
                            <div class="p-4 rounded-lg border-l-4 border-l-warning bg-yellow-50 text-yellow-800">
                                <h3 class="font-semibold flex items-center gap-2">üõ°Ô∏è Risk Assessment</h3>
                                <p class="text-text-secondary text-sm mt-1">${insight.risk_assessment}</p>
                            </div>
                            <div class="p-4 rounded-lg border-l-4 border-l-primary bg-blue-50 text-blue-800">
                                <h3 class="font-semibold flex items-center gap-2">‚ñ∂Ô∏è Suggested Action</h3>
                                <p class="text-text-secondary text-sm mt-1">${insight.suggested_action}</p>
                            </div>
                        </div>
                        ${insight.graph ? `
                        <div class="pt-6 border-t border-border">
                            <h3 class="text-xl font-bold text-center text-primary mb-4">AI-Generated Projection</h3>
                            <img src="${insight.graph}" alt="AI Generated Financial Graph" class="w-full h-auto rounded-lg shadow-md" />
                        </div>
                        ` : ''}
                    </div>`;

            } catch (error) {
                // 7. Show an error message if something goes wrong
                resultsContainer.innerHTML = `<p class="text-center text-error font-medium">Failed to get analysis. Please try again later. Details: ${error.message}</p>`;
                console.error('Error fetching analysis:', error);
            } finally {
                // 8. Restore the button to its original state
                submitButton.disabled = false;
                submitButton.innerHTML = 'Get My AI Insight';
            }
        });
    </script>
</body>
</html>
```eof

#### **File 2: All Other HTML Files**
For all your other pages (`homepage.html`, `user_dashboard.html`, etc.), you only need to ensure the mobile menu works. Just add this simple script tag right before the closing `</body>` tag.

```html:Standard Script for Other Pages
<script>
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenu.classList.toggle('hidden');
    }
</script>
```eof

With these changes, your original static site is now fully interactive and powered by your advanced AI backend.
